@ExtendWith(MockitoExtension.class)
class TraceIHMRepositoryTest {

    @Mock
    private NamedParameterJdbcTemplate jdbcTemplate;

    @InjectMocks
    private TraceIHMRepository traceIHMRepository;

    @Test
    @DisplayName("Should return list of traces when asked for traces IHM")
    void testFetchTracesFromTrino() {
        // Given: Mocked result set
        List<Trace> mockResult = List.of(
            new Trace("01 Jan 2023 12:00:00", "user1", "pf1", "prog1", "modi1", "zoli1", "tb1", "id1", "an1", "autres1"),
            new Trace("02 Jan 2023 14:30:00", "user2", "pf2", "prog2", "modi2", "zoli2", "tb2", "id2", "an2", "autres2")
        );

        // Mock query behavior
        Mockito.when(jdbcTemplate.query(Mockito.anyString(), Mockito.any(MapSqlParameterSource.class), Mockito.any()))
               .thenReturn(mockResult);

        // When: Fetch traces from repository
        List<Trace> result = traceIHMRepository.getTraces(LocalDate.parse("2023-01-01"), LocalDate.parse("2023-01-05"));

        // Then: Assertions
        assertEquals(2, result.size());
        assertEquals("01 Jan 2023 12:00:00", result.get(0).getDahmaj());
        assertEquals("user1", result.get(0).getIdUser());
        assertEquals("prog1", result.get(0).getNoProg());
    }
}
